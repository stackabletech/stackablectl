---
_templates:
  - helmChart: &template-minio-druid
      releaseName: minio-druid
      name: minio
      repo:
        name: minio
        url: https://charts.min.io/
      version: 4.0.2
      options:
        rootUser: root
        rootPassword: rootroot
        mode: standalone
        persistence:
          size: 15Gi
        users:
          - accessKey: druid
            secretKey: druiddruid
            policy: readwrite
        buckets:
          - name: druid
            policy: public
        resources:
          requests:
            memory: 2Gi
        service:
          type: NodePort
          nodePort: null
        consoleService:
          type: NodePort
          nodePort: null
  - helmChart: &template-minio-trino
      releaseName: minio-trino
      name: minio
      repo:
        name: minio
        url: https://charts.min.io/
      version: 4.0.15
      options:
        rootUser: root
        rootPassword: rootroot
        mode: standalone
        persistence:
          size: 10Gi
        users:
          - accessKey: trino
            secretKey: trinotrino
            policy: readwrite
          - accessKey: hive
            secretKey: hivehive
            policy: readwrite
          - accessKey: demo
            secretKey: demodemo
            policy: readwrite
        buckets:
          - name: demo
            policy: public
        resources:
          requests:
            cpu: 500m
            memory: 1Gi
        service:
          type: NodePort
          nodePort: null
        consoleService:
          type: NodePort
          nodePort: null
  - helmChart: &template-minio-trino-distributed
      releaseName: minio-trino
      name: minio
      repo:
        name: minio
        url: https://charts.min.io/
      version: 4.0.15
      options:
        rootUser: admin
        rootPassword: adminadmin
        mode: distributed
        replicas: 5
        persistence:
          size: 75Gi
        users:
          - accessKey: trino
            secretKey: trinotrino
            policy: readwrite
          - accessKey: hive
            secretKey: hivehive
            policy: readwrite
          - accessKey: demo
            secretKey: demodemo
            policy: readwrite
        buckets:
          - name: staging
            policy: public
          - name: warehouse
            policy: public
        resources:
          requests:
            cpu: 500m
            memory: 2Gi
        service:
          type: NodePort
          nodePort: null
        consoleService:
          type: NodePort
          nodePort: null
  - helmChart: &template-postgresql-hive
      releaseName: postgresql-hive
      name: postgresql
      repo:
        name: bitnami
        url: https://charts.bitnami.com/bitnami/
      version: 10.16.2
      options:
        # Old version (10) of helm-charts has old way of setting credentials
        postgresqlUsername: hive
        postgresqlPassword: hive
        postgresqlDatabase: hive
  - helmChart: &template-postgresql-hive-iceberg
      releaseName: postgresql-hive-iceberg
      name: postgresql
      repo:
        name: bitnami
        url: https://charts.bitnami.com/bitnami/
      version: 10.16.2
      options:
        # Old version (10) of helm-charts has old way of setting credentials
        postgresqlUsername: hive
        postgresqlPassword: hive
        postgresqlDatabase: hive
  - helmChart: &template-postgresql-superset
      releaseName: postgresql-superset
      name: postgresql
      repo:
        name: bitnami
        url: https://charts.bitnami.com/bitnami/
      version: 11.0.0
      options:
        auth:
          username: superset
          password: superset
          database: superset
  - helmChart: &template-postgresql-airflow
      releaseName: postgresql-airflow
      name: postgresql
      repo:
        name: bitnami
        url: https://charts.bitnami.com/bitnami/
      version: 11.0.0
      options:
        auth:
          username: airflow
          password: airflow
          database: airflow
  - helmChart: &template-redis-airflow
      releaseName: redis-airflow
      name: redis
      repo:
        name: bitnami
        url: https://charts.bitnami.com/bitnami/
      version: 16.13.2
      options:
        auth:
          password: airflow
        replica:
          replicaCount: 1

stacks:
  airflow:
    description: Stack containing Airflow scheduling platform
    stackableRelease: 22.09
    labels:
      - airflow
    manifests:
      - helmChart: *template-postgresql-airflow
      - helmChart: *template-redis-airflow
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/airflow/airflow.yaml
  data-warehouse-iceberg-trino-spark:
    description: Data warehouse using Iceberg warehouse on S3, Trino as query engine, Spark for streaming ingest and Superset for data visualization
    stackableRelease: 22.09-trino-0.7.0
    labels:
      - iceberg
      - trino
      - spark
      - superset
      - kafka
      - nifi
      - minio
      - s3
    manifests:
      - helmChart: *template-minio-trino-distributed
      - helmChart: *template-postgresql-hive
      - helmChart: *template-postgresql-hive-iceberg
      - helmChart: *template-postgresql-superset
      - plainYaml: stacks/data-warehouse-iceberg-trino-spark/hive-metastores.yaml
      - plainYaml: stacks/data-warehouse-iceberg-trino-spark/trino.yaml
      - plainYaml: stacks/data-warehouse-iceberg-trino-spark/zookeeper.yaml
      - plainYaml: stacks/data-warehouse-iceberg-trino-spark/kafka.yaml
      - plainYaml: stacks/data-warehouse-iceberg-trino-spark/nifi.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/superset.yaml # Reuse
  hdfs-hbase:
    description: HBase cluster using HDFS as underlying storage
    stackableRelease: 22.09
    labels:
      - hbase
      - hdfs
    manifests:
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/hdfs-hbase/zookeeper.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/hdfs-hbase/hdfs.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/hdfs-hbase/hbase.yaml
  kafka-druid-superset-s3:
    description: Stack containing Kafka, MinIO, Druid and Superset for data visualization
    stackableRelease: 22.09
    labels:
      - kafka
      - druid
      - superset
      - minio
      - s3
    manifests:
      - helmChart: *template-minio-druid
      - helmChart: *template-postgresql-superset
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/zookeeper.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/kafka.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/druid.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/superset.yaml
  nifi-kafka-druid-superset-s3:
    description: Stack containing NiFi, Kafka, Druid, MinIO and Superset for data visualization
    stackableRelease: 22.09
    labels:
      - nifi
      - kafka
      - druid
      - superset
      - minio
      - s3
    manifests:
      - helmChart: *template-minio-druid
      - helmChart: *template-postgresql-superset
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/zookeeper.yaml # Reuse
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/kafka.yaml # Reuse
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/druid.yaml # Reuse
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/kafka-druid-superset-s3/superset.yaml # Reuse
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/nifi-kafka-druid-superset-s3/nifi.yaml
  trino-superset-s3:
    description: Stack containing MinIO, Trino and Superset for data visualization
    stackableRelease: 22.09
    labels:
      - trino
      - superset
      - minio
      - s3
    manifests:
      - helmChart: *template-minio-trino
      - helmChart: *template-postgresql-hive
      - helmChart: *template-postgresql-superset
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/trino-superset-s3/hive-metastore.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/trino-superset-s3/trino.yaml
      - plainYaml: https://raw.githubusercontent.com/stackabletech/stackablectl/main/stacks/trino-superset-s3/superset.yaml
