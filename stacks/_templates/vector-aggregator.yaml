releaseName: vector-aggregator
name: vector
repo:
  name: vector
  url: https://helm.vector.dev
version: 0.26.0
options:
  role: Aggregator
  customConfig:
    sources:
      vector:
        address: 0.0.0.0:6000
        type: vector
        version: "2"
    sinks:
      opensearch:
        type: elasticsearch
        inputs:
          - vector
        endpoints:
          - https://opensearch-cluster-master.default.svc.cluster.local:9200
        mode: bulk
        # The auto-detection of the API version does not work in Vector
        # 0.33.0 for OpenSearch, so the version must be set explicitly
        # (see https://github.com/vectordotdev/vector/issues/17690).
        api_version: v8
        tls:
          # Add the certificate of the Certificate Authority
          # generated by the secret-operator so that the
          # OpenSearch service can be verified
          ca_file: /certs/ca.crt
        auth:
          strategy: basic
          user: admin
          password: {{ openSearchAdminPassword }}
  extraVolumeMounts:
    # Use the certificate generated by the secret-operator
    - name: tls
      mountPath: /certs
  extraVolumes:
    - name: tls
      ephemeral:
        volumeClaimTemplate:
          metadata:
            annotations:
              secrets.stackable.tech/class: tls
              secrets.stackable.tech/scope: pod
          spec:
            storageClassName: secrets.stackable.tech
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 1
