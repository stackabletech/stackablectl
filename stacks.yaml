---
stacks:
  druid-superset-s3:
    description: Stack containing MinIO, Druid and Superset for data visualization
    stackableRelease: 22.06-nightly
    labels:
      - druid
      - superset
      - minio
      - s3
    manifests:
      - helmChart:
          releaseName: minio-druid
          name: minio
          repo:
            name: minio
            url: https://charts.min.io/
          version: 4.0.2
          options:
            rootUser: root
            rootPassword: rootroot
            mode: standalone
            users:
              - accessKey: druid
                secretKey: druiddruid
                policy: readwrite
            buckets:
              - name: druid
                policy: public
            resources:
              requests:
                memory: 2Gi
            service:
              type: NodePort
              nodePort: null
            consoleService:
              type: NodePort
              nodePort: null
      - helmChart:
          releaseName: postgresql-superset
          name: postgresql
          repo:
            name: bitnami
            url: https://charts.bitnami.com/bitnami/
          version: 11.0.0
          options:
            auth:
              username: superset
              password: superset
              database: superset
      - plainYaml: stacks/druid-superset-s3/zookeeper.yaml
      - plainYaml: stacks/druid-superset-s3/druid.yaml
      - plainYaml: stacks/druid-superset-s3/superset.yaml
  trino-superset-s3:
    description: Stack containing MinIO, Trino and Superset for data visualization
    stackableRelease: 22.06-nightly
    labels:
      - trino
      - superset
      - minio
      - s3
    manifests:
      - helmChart:
          releaseName: minio-trino
          name: minio
          repo:
            name: minio
            url: https://charts.min.io/
          version: 4.0.5
          options:
            rootUser: root
            rootPassword: rootroot
            mode: standalone
            users:
              - accessKey: trino
                secretKey: trinotrino
                policy: readwrite
              - accessKey: hive
                secretKey: hivehive
                policy: readwrite
              - accessKey: demo
                secretKey: demodemo
                policy: readwrite
            buckets:
              - name: demo
                policy: public
            resources:
              requests:
                memory: 2Gi
            service:
              type: NodePort
              nodePort: null
            consoleService:
              type: NodePort
              nodePort: null
      - helmChart:
          releaseName: postgresql-hive
          name: postgresql
          repo:
            name: bitnami
            url: https://charts.bitnami.com/bitnami/
          version: 10.16.2
          options:
            # Old version (10) of helm-charts has old way of setting credentials
            postgresqlUsername: hive
            postgresqlPassword: hive
            postgresqlDatabase: hive
      - helmChart:
          releaseName: postgresql-superset
          name: postgresql
          repo:
            name: bitnami
            url: https://charts.bitnami.com/bitnami/
          version: 11.0.0
          options:
            auth:
              username: superset
              password: superset
              database: superset
      - plainYaml: stacks/trino-superset-s3/hive-metastore.yaml
      - plainYaml: stacks/trino-superset-s3/trino.yaml
      - plainYaml: stacks/trino-superset-s3/superset.yaml
  airflow:
    description: Stack containing Airflow scheduling platform
    stackableRelease: 22.06-nightly
    labels:
      - airflow
    manifests:
      - helmChart:
          releaseName: postgresql-airflow
          name: postgresql
          repo:
            name: bitnami
            url: https://charts.bitnami.com/bitnami/
          version: 11.0.0
          options:
            auth:
              username: airflow
              password: airflow
              database: airflow
      - helmChart:
          releaseName: redis-airflow
          name: redis
          repo:
            name: bitnami
            url: https://charts.bitnami.com/bitnami/
          version: 16.13.2
          options:
            auth:
              password: airflow
      - plainYaml: stacks/airflow/airflow.yaml
